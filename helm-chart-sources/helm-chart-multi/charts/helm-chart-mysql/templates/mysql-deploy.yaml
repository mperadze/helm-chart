apiVersion: v1
kind: Service
metadata: 
    name: mysql-service
    labels:
        env: prod
        owner: MishaPeradze
spec:
    selector:
        app: mysql # Selecting PODS with this label
    ports: 
        - name: mysql-listener
          protocol: TCP
          port: 3306         # Port on Load Balancer
          targetPort: 3306    # Port on POD
    # type: LoadBalancer

---
apiVersion: apps/v1
kind: Deployment
metadata:
    name: mysql-deployment
    labels:
        app: mysql
spec:
    #replicas: 1
    selector: 
        matchLabels:
            app: mysql
    strategy:
        type: Recreate
    template: 
        metadata: 
            labels: 
                app: mysql
        spec: 
            containers: 
                - name: mysql
                  image: {{ .Values.container.image }}
                  ports: 
                    - containerPort: 3306
                  env: 
                    - name: MYSQL_ROOT_PASSWORD
                      valueFrom:
                        secretKeyRef:
                            name: mysql-secret
                            key: mysql-root-password
                  volumeMounts:
                    - name: mysql-persistent-storage
                      mountPath: /var/lib/mysql
            volumes:
            - name: mysql-persistent-storage
              persistentVolumeClaim:
                claimName: mysql-pv-claim

